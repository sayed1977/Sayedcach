<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø§Ù„Ø£Ø³ØªØ§Ø° Ø³ÙŠØ¯ Ù…ØµØ·ÙÙ‰ | Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background: #f4f7fe; }
        .tab-content { display: none; transition: all 0.3s ease; }
        .tab-content.active { display: block; animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
        .btn-grad { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); }
    </style>
</head>
<body class="pb-10">

    <header class="bg-indigo-950 text-white pt-10 pb-16 px-6 text-center shadow-2xl rounded-b-[4rem] relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-full opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
        <h1 class="text-3xl md:text-4xl font-extrabold relative z-10">Ø§Ù„Ø£Ø³ØªØ§Ø° Ø³ÙŠØ¯ Ù…ØµØ·ÙÙ‰ Ø³ÙŠØ¯</h1>
        <p class="text-indigo-300 mt-2 text-lg font-medium relative z-10">Ù…Ø¹Ù„Ù… Ø®Ø¨ÙŠØ± Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø©</p>
    </header>

    <nav class="flex justify-center -mt-8 px-4 relative z-20">
        <div class="bg-white p-2 rounded-2xl shadow-xl flex space-x-2 space-x-reverse overflow-x-auto max-w-full">
            <button onclick="openTab('tab1')" id="btn-tab1" class="tab-btn px-6 py-3 rounded-xl font-bold transition-all duration-300 bg-indigo-600 text-white shadow-lg">ğŸ‘¥ Ø§Ù„Ø·Ù„Ø§Ø¨</button>
            <button onclick="openTab('tab2')" id="btn-tab2" class="tab-btn px-6 py-3 rounded-xl font-bold transition-all duration-300 text-gray-500 hover:bg-gray-100">ğŸ’° Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</button>
            <button onclick="openTab('tab3')" id="btn-tab3" class="tab-btn px-6 py-3 rounded-xl font-bold transition-all duration-300 text-gray-500 hover:bg-gray-100">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
        </div>
    </nav>

    <main class="max-w-4xl mx-auto px-4 mt-8">

        <section id="tab1" class="tab-content active">
            <div class="glass p-6 rounded-3xl shadow-sm mb-8 border-t-4 border-indigo-600">
                <h3 class="text-xl font-bold mb-4 text-indigo-950 flex items-center">
                    <span class="ml-2">â•</span> Ø¥Ø¶Ø§ÙØ© Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¯Ø±Ø§Ø³ÙŠØ©
                </h3>
                <div class="flex flex-col sm:flex-row gap-3">
                    <input id="groupName" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© (Ù…Ø«Ù„Ø§Ù‹: ØªØ§Ù„ØªØ© Ø«Ø§Ù†ÙˆÙŠ - Ø§Ù„Ø£Ø­Ø¯)" class="flex-1 p-4 border rounded-2xl focus:ring-2 focus:ring-indigo-500 outline-none shadow-sm">
                    <button onclick="addGroup()" class="btn-grad text-white px-8 py-4 rounded-2xl font-bold shadow-lg hover:scale-105 active:scale-95 transition">Ø¥Ø¶Ø§ÙØ©</button>
                </div>
            </div>
            <div id="groupsList" class="grid gap-6 grid-cols-1 md:grid-cols-2"></div>
        </section>

        <section id="tab2" class="tab-content">
            <div class="glass p-6 rounded-3xl shadow-lg border-t-4 border-green-600">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8">
                    <div class="space-y-2">
                        <label class="font-bold text-gray-700 mr-2">Ø§Ø®ØªØ§Ø± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©:</label>
                        <select id="payGroupSelect" onchange="renderPaymentList()" class="w-full p-4 border rounded-2xl bg-gray-50 shadow-inner appearance-none"></select>
                    </div>
                    <div class="space-y-2">
                        <label class="font-bold text-gray-700 mr-2">Ø§Ø®ØªØ§Ø± Ø§Ù„Ø´Ù‡Ø±:</label>
                        <select id="payMonthSelect" onchange="renderPaymentList()" class="w-full p-4 border rounded-2xl bg-gray-50 shadow-inner">
                            <option>Ø³Ø¨ØªÙ…Ø¨Ø±</option><option>Ø£ÙƒØªÙˆØ¨Ø±</option><option>Ù†ÙˆÙÙ…Ø¨Ø±</option><option>Ø¯ÙŠØ³Ù…Ø¨Ø±</option>
                            <option>ÙŠÙ†Ø§ÙŠØ±</option><option>ÙØ¨Ø±Ø§ÙŠØ±</option><option>Ù…Ø§Ø±Ø³</option><option>Ø£Ø¨Ø±ÙŠÙ„</option>
                            <option>Ù…Ø§ÙŠÙˆ</option><option>ÙŠÙˆÙ†ÙŠÙˆ</option>
                        </select>
                    </div>
                </div>
                <div id="paymentStudentsList" class="space-y-4"></div>
            </div>
        </section>

        <section id="tab3" class="tab-content">
            <div class="glass p-6 rounded-3xl shadow-lg border-t-4 border-purple-600">
                <div class="grid grid-cols-2 gap-4 mb-8">
                    <select id="repGroupSelect" onchange="renderReports()" class="p-4 border rounded-2xl bg-gray-50"></select>
                    <select id="repMonthSelect" onchange="renderReports()" class="p-4 border rounded-2xl bg-gray-50"></select>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div class="bg-green-50 p-6 rounded-3xl border border-green-100 shadow-sm">
                        <h4 class="font-bold text-green-800 mb-4 flex justify-between"><span>âœ… Ø§Ù„Ù…Ø³Ø¯Ø¯ÙˆÙ†</span> <span id="paidCount" class="text-xs bg-green-200 px-2 py-1 rounded-full text-green-900">0</span></h4>
                        <ul id="paidList" class="space-y-3 max-h-60 overflow-y-auto pr-2 custom-scroll text-sm"></ul>
                    </div>
                    <div class="bg-red-50 p-6 rounded-3xl border border-red-100 shadow-sm">
                        <h4 class="font-bold text-red-800 mb-4 flex justify-between"><span>âŒ Ø§Ù„Ù…ØªØ£Ø®Ø±ÙˆÙ†</span> <span id="unpaidCount" class="text-xs bg-red-200 px-2 py-1 rounded-full text-red-900">0</span></h4>
                        <ul id="unpaidList" class="space-y-3 max-h-60 overflow-y-auto pr-2 custom-scroll text-sm"></ul>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="bg-indigo-900 text-white p-6 rounded-[2rem] shadow-xl text-center">
                        <p class="text-sm text-indigo-200 mb-1">Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</p>
                        <h5 id="groupTotal" class="text-3xl font-black italic">0 Ø¬.Ù…</h5>
                    </div>
                    <div class="bg-indigo-600 text-white p-6 rounded-[2rem] shadow-xl text-center">
                        <p class="text-sm text-indigo-100 mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ù‡Ø± (Ø¹Ø§Ù…)</p>
                        <h5 id="allTotal" class="text-3xl font-black italic">0 Ø¬.Ù…</h5>
                    </div>
                </div>
                <button onclick="downloadData()" class="w-full py-3 text-sm text-indigo-600 font-bold border-2 border-dashed border-indigo-200 rounded-xl hover:bg-indigo-50 transition">ğŸ’¾ Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </div>
        </section>

    </main>

    <script>
        let data = JSON.parse(localStorage.getItem('mr_sayed_math_v1')) || { groups: [] };

        function saveData() {
            localStorage.setItem('mr_sayed_math_v1', JSON.stringify(data));
            renderGroups();
            updateSelects();
        }

        function openTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.className = "tab-btn px-6 py-3 rounded-xl font-bold transition-all duration-300 text-gray-500 hover:bg-gray-100");
            
            document.getElementById(tabId).classList.add('active');
            const activeBtn = document.getElementById('btn-' + tabId);
            activeBtn.className = "tab-btn px-6 py-3 rounded-xl font-bold transition-all duration-300 bg-indigo-600 text-white shadow-lg";
            
            if(tabId === 'tab2') renderPaymentList();
            if(tabId === 'tab3') renderReports();
        }

        function addGroup() {
            const name = document.getElementById('groupName').value.trim();
            if (!name) return;
            data.groups.push({ id: Date.now(), name, students: [] });
            document.getElementById('groupName').value = '';
            saveData();
        }

        function deleteGroup(id) { if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨ÙƒÙ„ Ø·Ù„Ø§Ø¨Ù‡Ø§ØŸ')) { data.groups = data.groups.filter(g => g.id !== id); saveData(); } }

        function addStudent(groupId) {
            const name = prompt("Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯:");
            if (name) {
                const group = data.groups.find(g => g.id === groupId);
                group.students.push({ id: Date.now(), name, payments: {} });
                saveData();
            }
        }

        function renderGroups() {
            const container = document.getElementById('groupsList');
            container.innerHTML = data.groups.map(g => `
                <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-gray-100 relative overflow-hidden">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h4 class="font-bold text-xl text-indigo-900">${g.name}</h4>
                            <p class="text-sm text-gray-400 mt-1">${g.students.length} Ø·Ø§Ù„Ø¨ Ù…Ø³Ø¬Ù„</p>
                        </div>
                        <button onclick="deleteGroup(${g.id})" class="text-gray-300 hover:text-red-500 transition">ğŸ—‘ï¸</button>
                    </div>
                    <button onclick="addStudent(${g.id})" class="w-full py-3 bg-indigo-50 text-indigo-600 rounded-2xl font-bold hover:bg-indigo-100 transition">+ Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</button>
                    <div class="mt-4 text-xs text-gray-400 truncate">${g.students.map(s => s.name).join(' ØŒ ')}</div>
                </div>
            `).join('');
        }

        function updateSelects() {
            const options = data.groups.map(g => `<option value="${g.id}">${g.name}</option>`).join('');
            document.getElementById('payGroupSelect').innerHTML = options || '<option>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</option>';
            document.getElementById('repGroupSelect').innerHTML = options || '<option>-</option>';
            document.getElementById('repMonthSelect').innerHTML = document.getElementById('payMonthSelect').innerHTML;
        }

        function renderPaymentList() {
            const groupId = document.getElementById('payGroupSelect').value;
            const month = document.getElementById('payMonthSelect').value;
            const container = document.getElementById('paymentStudentsList');
            const group = data.groups.find(g => g.id == groupId);
            
            if (!group) { container.innerHTML = "<p class='text-center py-10 text-gray-400'>Ø£Ø¶Ù Ù…Ø¬Ù…ÙˆØ¹Ø© Ø£ÙˆÙ„Ø§Ù‹ Ù…Ù† ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø·Ù„Ø§Ø¨</p>"; return; }

            container.innerHTML = group.students.map(s => {
                const pay = s.payments[month];
                return `
                <div class="flex items-center justify-between p-5 rounded-3xl border transition-all ${pay ? 'bg-green-50 border-green-200' : 'bg-white border-gray-100 shadow-sm'}">
                    <span class="font-bold text-gray-800">${s.name}</span>
                    <div class="flex items-center gap-3">
                        ${pay ? `<div class="text-left"><p class="text-green-700 font-bold">${pay.amount} Ø¬.Ù…</p><p class="text-[10px] text-gray-400">${pay.date}</p></div>` : 
                        `<input id="amt-${s.id}" type="number" placeholder="0" class="w-16 p-2 border rounded-xl text-center shadow-inner">
                         <button onclick="recordPayment(${groupId}, ${s.id})" class="bg-green-600 text-white px-5 py-2 rounded-xl text-sm font-bold shadow-md hover:bg-green-700">Ø¯ÙØ¹</button>`}
                    </div>
                </div>`;
            }).join('');
        }

        function recordPayment(groupId, studentId) {
            const month = document.getElementById('payMonthSelect').value;
            const amount = document.getElementById(`amt-${studentId}`).value;
            if (!amount) return;
            const group = data.groups.find(g => g.id == groupId);
            const student = group.students.find(s => s.id == studentId);
            const now = new Date();
            student.payments[month] = { 
                amount: parseFloat(amount), 
                date: now.toLocaleDateString('ar-EG') + ' ' + now.toLocaleTimeString('ar-EG', {hour:'2-digit', minute:'2-digit'})
            };
            saveData();
            renderPaymentList();
        }

        function renderReports() {
            const groupId = document.getElementById('repGroupSelect').value;
            const month = document.getElementById('repMonthSelect').value;
            const group = data.groups.find(g => g.id == groupId);
            let pHTML = '', uHTML = '', gT = 0, aT = 0, pCount = 0, uCount = 0;

            if(group) {
                group.students.forEach(s => {
                    if(s.payments[month]) {
                        pHTML += `<li class="flex justify-between items-center bg-white p-3 rounded-xl shadow-sm border-r-4 border-green-500"><span>${s.name}</span> <span class="font-bold text-green-600">${s.payments[month].amount}</span></li>`;
                        gT += s.payments[month].amount; pCount++;
                    } else {
                        uHTML += `<li class="bg-white p-3 rounded-xl shadow-sm border-r-4 border-red-500 text-gray-600">${s.name}</li>`;
                        uCount++;
                    }
                });
            }
            data.groups.forEach(g => g.students.forEach(s => { if(s.payments[month]) aT += s.payments[month].amount; }));
            
            document.getElementById('paidList').innerHTML = pHTML || "Ù„Ø§ ÙŠÙˆØ¬Ø¯";
            document.getElementById('unpaidList').innerHTML = uHTML || "Ø§Ù„ÙƒÙ„ Ù…Ø³Ø¯Ø¯";
            document.getElementById('groupTotal').innerText = gT + " Ø¬.Ù…";
            document.getElementById('allTotal').innerText = aT + " Ø¬.Ù…";
            document.getElementById('paidCount').innerText = pCount;
            document.getElementById('unpaidCount').innerText = uCount;
        }

        function downloadData() {
            const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = `Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„Ø£Ø³ØªØ§Ø°_Ø³ÙŠØ¯_${new Date().toLocaleDateString()}.json`;
            a.click();
        }

        saveData();
    </script>
</body>
</html>
