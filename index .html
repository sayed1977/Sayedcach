<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø§Ù„Ø£Ø³ØªØ§Ø° Ø³ÙŠØ¯ Ù…ØµØ·ÙÙ‰ | Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e3a8a">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background: #f4f7fe; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .btn-grad { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); }
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="pb-10">

    <header class="bg-indigo-950 text-white pt-10 pb-16 px-6 text-center shadow-2xl rounded-b-[3rem] relative overflow-hidden">
        <h1 class="text-3xl font-extrabold relative z-10">Ø§Ù„Ø£Ø³ØªØ§Ø° Ø³ÙŠØ¯ Ù…ØµØ·ÙÙ‰ Ø³ÙŠØ¯</h1>
        <p class="text-indigo-300 mt-2 text-lg font-medium relative z-10">Ù…Ø¹Ù„Ù… Ø®Ø¨ÙŠØ± Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø©</p>
    </header>

    <nav class="flex justify-center -mt-8 px-4 relative z-20">
        <div class="bg-white p-2 rounded-2xl shadow-xl flex space-x-2 space-x-reverse overflow-x-auto">
            <button onclick="openTab('tab1')" id="btn-tab1" class="tab-btn px-6 py-3 rounded-xl font-bold transition-all bg-indigo-600 text-white shadow-lg">ğŸ‘¥ Ø§Ù„Ø·Ù„Ø§Ø¨</button>
            <button onclick="openTab('tab2')" id="btn-tab2" class="tab-btn px-6 py-3 rounded-xl font-bold transition-all text-gray-500 hover:bg-gray-100">ğŸ’° Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</button>
            <button onclick="openTab('tab3')" id="btn-tab3" class="tab-btn px-6 py-3 rounded-xl font-bold transition-all text-gray-500 hover:bg-gray-100">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
        </div>
    </nav>

    <main class="max-w-4xl mx-auto px-4 mt-8">
        <section id="tab1" class="tab-content active">
            <div class="glass p-6 rounded-3xl shadow-sm mb-8 border-t-4 border-indigo-600">
                <h3 class="text-xl font-bold mb-4 text-indigo-950">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                <div class="flex flex-col sm:flex-row gap-3">
                    <input id="groupName" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©..." class="flex-1 p-4 border rounded-2xl outline-none focus:ring-2 focus:ring-indigo-500 shadow-sm">
                    <button onclick="addGroup()" class="btn-grad text-white px-8 py-4 rounded-2xl font-bold shadow-lg">Ø¥Ø¶Ø§ÙØ©</button>
                </div>
            </div>
            <div id="groupsList" class="grid gap-6 grid-cols-1 md:grid-cols-2"></div>
        </section>

        <section id="tab2" class="tab-content">
            <div class="glass p-6 rounded-3xl shadow-lg border-t-4 border-green-600">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8 text-right">
                    <div class="space-y-2">
                        <label class="font-bold text-gray-700">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©:</label>
                        <select id="payGroupSelect" onchange="renderPaymentList()" class="w-full p-4 border rounded-2xl bg-gray-50 appearance-none"></select>
                    </div>
                    <div class="space-y-2">
                        <label class="font-bold text-gray-700">Ø§Ù„Ø´Ù‡Ø±:</label>
                        <select id="payMonthSelect" onchange="renderPaymentList()" class="w-full p-4 border rounded-2xl bg-gray-50">
                            <option>Ø³Ø¨ØªÙ…Ø¨Ø±</option><option>Ø£ÙƒØªÙˆØ¨Ø±</option><option>Ù†ÙˆÙÙ…Ø¨Ø±</option><option>Ø¯ÙŠØ³Ù…Ø¨Ø±</option>
                            <option>ÙŠÙ†Ø§ÙŠØ±</option><option>ÙØ¨Ø±Ø§ÙŠØ±</option><option>Ù…Ø§Ø±Ø³</option><option>Ø£Ø¨Ø±ÙŠÙ„</option>
                            <option>Ù…Ø§ÙŠÙˆ</option><option>ÙŠÙˆÙ†ÙŠÙˆ</option>
                        </select>
                    </div>
                </div>
                <div id="paymentStudentsList" class="space-y-4"></div>
            </div>
        </section>

        <section id="tab3" class="tab-content">
            <div class="glass p-6 rounded-3xl shadow-lg border-t-4 border-purple-600">
                <div class="grid grid-cols-2 gap-4 mb-8">
                    <select id="repGroupSelect" onchange="renderReports()" class="p-4 border rounded-2xl bg-gray-50"></select>
                    <select id="repMonthSelect" onchange="renderReports()" class="p-4 border rounded-2xl bg-gray-50"></select>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div class="bg-green-50 p-5 rounded-3xl border border-green-100">
                        <h4 class="font-bold text-green-800 mb-4 flex justify-between">âœ… Ø§Ù„Ù…Ø³Ø¯Ø¯ÙˆÙ† <span id="paidCount" class="bg-green-200 px-2 py-1 rounded-full text-xs text-green-900">0</span></h4>
                        <ul id="paidList" class="space-y-3 max-h-60 overflow-y-auto custom-scroll text-sm"></ul>
                    </div>
                    <div class="bg-red-50 p-5 rounded-3xl border border-red-100">
                        <h4 class="font-bold text-red-800 mb-4 flex justify-between">âŒ Ø§Ù„Ù…ØªØ£Ø®Ø±ÙˆÙ† <span id="unpaidCount" class="bg-red-200 px-2 py-1 rounded-full text-xs text-red-900">0</span></h4>
                        <ul id="unpaidList" class="space-y-3 max-h-60 overflow-y-auto custom-scroll text-sm"></ul>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-indigo-900 text-white p-6 rounded-[2rem] text-center shadow-xl">
                        <p class="text-xs text-indigo-200">Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</p>
                        <h5 id="groupTotal" class="text-2xl font-black">0 Ø¬.Ù…</h5>
                    </div>
                    <div class="bg-indigo-600 text-white p-6 rounded-[2rem] text-center shadow-xl">
                        <p class="text-xs text-indigo-100">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ù‡Ø±</p>
                        <h5 id="allTotal" class="text-2xl font-black">0 Ø¬.Ù…</h5>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        let data = JSON.parse(localStorage.getItem('mr_sayed_db')) || { groups: [] };
        function saveData() { localStorage.setItem('mr_sayed_db', JSON.stringify(data)); renderGroups(); updateSelects(); }
        function openTab(id) { 
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.className = "tab-btn px-6 py-3 rounded-xl font-bold transition-all text-gray-500 hover:bg-gray-100");
            document.getElementById(id).classList.add('active');
            document.getElementById('btn-'+id).className = "tab-btn px-6 py-3 rounded-xl font-bold transition-all bg-indigo-600 text-white shadow-lg";
            if(id === 'tab2') renderPaymentList();
            if(id === 'tab3') renderReports();
        }
        function addGroup() { const n = document.getElementById('groupName').value; if(n){ data.groups.push({id:Date.now(), name:n, students:[]}); document.getElementById('groupName').value=''; saveData(); } }
        function addStudent(gId) { const n = prompt("Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:"); if(n){ data.groups.find(g=>g.id==gId).students.push({id:Date.now(), name:n, payments:{}}); saveData(); } }
        function renderGroups() {
            document.getElementById('groupsList').innerHTML = data.groups.map(g => `
                <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-gray-100">
                    <h4 class="font-bold text-xl text-indigo-900 mb-4">${g.name}</h4>
                    <button onclick="addStudent(${g.id})" class="w-full py-3 bg-indigo-50 text-indigo-600 rounded-2xl font-bold hover:bg-indigo-100 transition">+ Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</button>
                    <div class="mt-4 text-xs text-gray-400 truncate">${g.students.map(s => s.name).join(' ØŒ ')}</div>
                </div>`).join('');
        }
        function updateSelects() {
            const opts = data.groups.map(g => `<option value="${g.id}">${g.name}</option>`).join('');
            document.getElementById('payGroupSelect').innerHTML = opts || '<option>-</option>';
            document.getElementById('repGroupSelect').innerHTML = opts || '<option>-</option>';
            document.getElementById('repMonthSelect').innerHTML = document.getElementById('payMonthSelect').innerHTML;
        }
        function renderPaymentList() {
            const gId = document.getElementById('payGroupSelect').value;
            const m = document.getElementById('payMonthSelect').value;
            const g = data.groups.find(g=>g.id==gId);
            if(!g) return;
            document.getElementById('paymentStudentsList').innerHTML = g.students.map(s => {
                const p = s.payments[m];
                return `<div class="flex items-center justify-between p-5 rounded-3xl border ${p?'bg-green-50 border-green-200':'bg-white shadow-sm'}">
                    <span class="font-bold">${s.name}</span>
                    <div class="flex gap-2">
                        ${p ? `<span class="text-green-700 font-bold">${p.amount} Ø¬.Ù…</span>` : 
                        `<input id="amt-${s.id}" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" class="w-20 p-2 border rounded-xl text-sm">
                         <button onclick="record(${gId},${s.id})" class="bg-green-600 text-white px-4 py-2 rounded-xl text-sm font-bold">ØªØ³Ø¬ÙŠÙ„</button>`}
                    </div></div>`;}).join('');
        }
        function record(gId, sId) {
            const m = document.getElementById('payMonthSelect').value;
            const a = document.getElementById(`amt-${sId}`).value;
            if(!a) return;
            const s = data.groups.find(g=>g.id==gId).students.find(s=>s.id==sId);
            const now = new Date();
            s.payments[m] = { amount:parseFloat(a), date:now.toLocaleDateString('ar-EG') + ' ' + now.toLocaleTimeString('ar-EG',{hour:'2-digit',minute:'2-digit'}) };
            saveData(); renderPaymentList();
        }
        function renderReports() {
            const gId = document.getElementById('repGroupSelect').value;
            const m = document.getElementById('repMonthSelect').value;
            const g = data.groups.find(g=>g.id==gId);
            let pH='', uH='', gT=0, aT=0, pC=0, uC=0;
            if(g) {
                g.students.forEach(s => {
                    if(s.payments[m]) { pH+=`<li class="flex justify-between bg-white p-3 rounded-xl shadow-sm border-r-4 border-green-500"><span>${s.name}</span> <b>${s.payments[m].amount}</b></li>`; gT+=s.payments[m].amount; pC++; }
                    else { uH+=`<li class="bg-white p-3 rounded-xl shadow-sm border-r-4 border-red-500">${s.name}</li>`; uC++; }
                });
            }
            data.groups.forEach(g=>g.students.forEach(s=>{if(s.payments[m]) aT+=s.payments[m].amount}));
            document.getElementById('paidList').innerHTML=pH; document.getElementById('unpaidList').innerHTML=uH;
            document.getElementById('groupTotal').innerText=gT+" Ø¬.Ù…"; document.getElementById('allTotal').innerText=aT+" Ø¬.Ù…";
            document.getElementById('paidCount').innerText=pC; document.getElementById('unpaidCount').innerText=uC;
        }
        saveData();
    </script>
</body>
</html>
